<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSharp Counter - Simple Working Version</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .demo-container {
            background: white;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 20px;
        }
        
        .counter-display {
            font-size: 5em;
            font-weight: bold;
            color: #3498db;
            margin: 30px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            transition: color 0.3s ease;
        }
        
        .websharp-button {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            padding: 20px 40px;
            font-size: 20px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.3);
            margin: 15px;
            font-weight: bold;
        }
        
        .websharp-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(52, 152, 219, 0.4);
        }
        
        .reset-button {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.3);
        }
        
        .reset-button:hover {
            box-shadow: 0 8px 25px rgba(231, 76, 60, 0.4);
        }
        
        .status-panel {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            margin-top: 20px;
        }
        
        .console-output {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Consolas', 'Monaco', monospace;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            margin: 15px 0;
        }
        
        .success { background: #e8f5e8; border: 1px solid #4caf50; color: #2e7d32; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .failure { background: #ffebee; border: 1px solid #f44336; color: #c62828; padding: 10px; border-radius: 5px; margin: 10px 0; }
    </style>
</head>
<body>
    <!-- Ultra Simple WebSharp Runtime -->
    <script>
    function simpleWebSharpCompiler(code) {
        console.log('üîß Original C# code:', code);
        
        // Step 1: Remove ALL comments completely
        let js = code.replace(/\/\/.*$/gm, '');
        console.log('üîß After comment removal:', js);
        
        // Step 2: Normalize whitespace
        js = js.replace(/\s+/g, ' ').trim();
        console.log('üîß After whitespace normalization:', js);
        
        // Step 3: Simple replacements only
        js = js.replace(/public class (\w+) {/, 'class $1 {');
        js = js.replace(/private static int (\w+) = (\d+);/, 'static $1 = $2;');
        js = js.replace(/public static void (\w+)\(\) {/, 'static $1() {');
        js = js.replace(/private static void (\w+)\(\) {/, 'static $1() {');
        js = js.replace(/Console\.WriteLine\("([^"]*)"\);/g, 'console.log("$1");');
        
        console.log('üîß After basic replacements:', js);
        
        // Step 4: Handle method calls - simple approach
        js = js.replace(/UpdateDisplay\(\);/g, 'ButtonCounter.UpdateDisplay();');
        
        console.log('üîß Final JavaScript:', js);
        return js;
    }
    
    function processSimpleWebScript() {
        const tags = document.querySelectorAll('wscript');
        console.log('üîç Found', tags.length, 'wscript tags');
        
        tags.forEach((tag, index) => {
            const source = tag.textContent || tag.innerHTML;
            console.log(`üîß Processing tag ${index + 1}`);
            
            try {
                const js = simpleWebSharpCompiler(source);
                console.log('‚úÖ Compilation successful');
                
                // Test syntax
                new Function(js);
                console.log('‚úÖ Syntax validation passed');
                
                // Execute
                eval(js);
                console.log('‚úÖ Execution completed');
                
            } catch (error) {
                console.error('‚ùå Error:', error.message);
                const errorDiv = document.createElement('div');
                errorDiv.className = 'failure';
                errorDiv.innerHTML = `<strong>‚ùå WebSharp Error:</strong> ${error.message}`;
                tag.parentNode.insertBefore(errorDiv, tag.nextSibling);
            }
        });
    }
    
    // Initialize
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', processSimpleWebScript);
    } else {
        processSimpleWebScript();
    }
    </script>
    
    <div class="demo-container">
        <h1>üéØ WebSharp Button Counter</h1>
        <p><strong>Ultra-Simple Working Version</strong></p>
        
        <div id="counter-container">
            <div class="counter-display" id="counter-display">0</div>
        </div>
        
        <div id="button-container"></div>
    </div>

    <!-- Ultra Simple WebSharp Code -->
    <wscript>
public class ButtonCounter {
    private static int count = 0;
    
    public static void Initialize() {
        Console.WriteLine("Creating buttons");
        
        var btn1 = document.createElement("button");
        btn1.textContent = "Click Me!";
        btn1.className = "websharp-button";
        btn1.id = "increment-btn";
        
        var btn2 = document.createElement("button");
        btn2.textContent = "Reset";
        btn2.className = "websharp-button reset-button";
        btn2.id = "reset-btn";
        
        var container = document.getElementById("button-container");
        container.appendChild(btn1);
        container.appendChild(btn2);
        
        UpdateDisplay();
        Console.WriteLine("Buttons created");
    }
    
    private static void UpdateDisplay() {
        var display = document.getElementById("counter-display");
        display.textContent = count.toString();
        
        if (count < 5) {
            display.style.color = "#3498db";
        } else {
            display.style.color = "#e74c3c";
        }
    }
}

ButtonCounter.Initialize();
    </wscript>

    <!-- JavaScript Event Handlers -->
    <script>
    setTimeout(() => {
        const btn1 = document.getElementById('increment-btn');
        const btn2 = document.getElementById('reset-btn');
        
        if (btn1 && btn2) {
            let count = 0;
            
            btn1.onclick = () => {
                count++;
                const display = document.getElementById('counter-display');
                display.textContent = count;
                display.style.color = count < 5 ? "#3498db" : "#e74c3c";
                console.log('Count:', count);
            };
            
            btn2.onclick = () => {
                count = 0;
                const display = document.getElementById('counter-display');
                display.textContent = "0";
                display.style.color = "#3498db";
                console.log('Reset to 0');
            };
            
            document.body.innerHTML += '<div class="success">‚úÖ Counter is working!</div>';
        } else {
            document.body.innerHTML += '<div class="failure">‚ùå Buttons not found</div>';
        }
    }, 1000);
    </script>

    <div class="status-panel">
        <h2>üìä Status</h2>
        <div id="console-output" class="console-output">Console output will appear here...</div>
    </div>

    <script>
    // Capture console output
    const consoleOutput = document.getElementById('console-output');
    const originalConsoleLog = console.log;
    console.log = function(...args) {
        originalConsoleLog.apply(console, arguments);
        const message = args.join(' ');
        consoleOutput.textContent += new Date().toLocaleTimeString() + ' ' + message + '\n';
        consoleOutput.scrollTop = consoleOutput.scrollHeight;
    };
    </script>
</body>
</html>
