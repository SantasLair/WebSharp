<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSharp Error Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .error { background: #ffebee; border: 1px solid #f44336; padding: 10px; margin: 10px 0; color: #c62828; }
        .success { background: #e8f5e8; border: 1px solid #4caf50; padding: 10px; margin: 10px 0; color: #2e7d32; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>WebSharp Error Debug</h1>
    <div id="debug-output"></div>
    
    <script src="minimal-runtime.js"></script>
    
    <!-- Test 1: Absolute minimal -->
    <h2>Test 1: Console Only</h2>
    <wscript>
    Console.WriteLine("Hello World");
    </wscript>
    
    <!-- Test 2: Simple variable -->
    <h2>Test 2: Simple Variable</h2>
    <wscript>
    var message = "Test message";
    Console.WriteLine(message);
    </wscript>
    
    <!-- Test 3: DOM element -->
    <h2>Test 3: DOM Element</h2>
    <wscript>
    var div = document.createElement("div");
    div.textContent = "DOM test";
    document.body.appendChild(div);
    </wscript>
    
    <!-- Test 4: Class (this might be the issue) -->
    <h2>Test 4: Class</h2>
    <wscript>
    public class TestClass {
        public static void Test() {
            Console.WriteLine("Class test");
        }
    }
    TestClass.Test();
    </wscript>
    
    <script>
    // Enhanced error tracking
    window.addEventListener('error', function(e) {
        console.error('Global error:', e.error);
        const debugDiv = document.getElementById('debug-output');
        debugDiv.innerHTML += `<div class="error">
            <strong>Global Error:</strong><br>
            ${e.error.message}<br>
            <small>File: ${e.filename}, Line: ${e.lineno}</small>
        </div>`;
    });
    
    // Check results after processing
    setTimeout(() => {
        const errors = document.querySelectorAll('.error, [style*="ffebee"]');
        const debugDiv = document.getElementById('debug-output');
        
        if (errors.length > 0) {
            debugDiv.innerHTML += `<div class="error">Found ${errors.length} error(s) on page</div>`;
        } else {
            debugDiv.innerHTML += `<div class="success">No errors found - all tests passed!</div>`;
        }
        
        // Show compilation results
        if (window.WebSharpRuntime && window.WebSharpRuntime.lastCompilation) {
            debugDiv.innerHTML += `<div>
                <strong>Last Compilation:</strong>
                <pre>${window.WebSharpRuntime.lastCompilation}</pre>
            </div>`;
        }
    }, 2000);
    </script>
</body>
</html>
